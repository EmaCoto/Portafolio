---
import TitleSecundary from "./TitleSecundary.astro";

const education = [
  { title: "Empírico", course: "Curso de Astro", year: "2026", side: "left" },
  { title: "Ademass", course: "Curso de Wordpress", year: "2024", side: "right" },
  { title: "Ademass", course: "Curso de Laravel", year: "2023", side: "left" },
  { title: "Ademass", course: "Curso de SQL", year: "2023", side: "right" },
  { title: "Google Actívate", course: "Intro al desarrollo web", year: "2023", side: "left" },
  { title: "SENA", course: "Programación de software", year: "2021 | 2023", side: "right" },
  { title: "SENA", course: "Técnico en sistemas", year: "2019 | 2021", side: "left" },
];
---

<section id="education-section" class="relative w-full bg-[#0a0709] py-32 overflow-hidden">
  <TitleSecundary h2="Formación" span="Mi Trayectoria" />

  <div class="relative max-w-6xl mx-auto mt-20 px-4 min-h-375">
    
    <svg
      class="absolute inset-0 h-full w-full z-0 pointer-events-none"
      viewBox="0 0 400 1500"
      preserveAspectRatio="xMidYMin meet"
    >
      <defs>
        <linearGradient id="lineGradient" x1="0%" y1="0%" x2="0%" y2="100%">
          <stop offset="0%" stop-color="#72bf78" stop-opacity="0" />
          <stop offset="50%" stop-color="#72bf78" stop-opacity="1" />
          <stop offset="100%" stop-color="#72bf78" stop-opacity="0" />
        </linearGradient>
        <filter id="glow">
          <feGaussianBlur stdDeviation="3" result="coloredBlur" />
          <feMerge>
            <feMergeNode in="coloredBlur" />
            <feMergeNode in="SourceGraphic" />
          </feMerge>
        </filter>
      </defs>

      <path
        id="bg-path"
        d="M200 0 C200 100, 100 150, 100 250 C100 350, 300 450, 300 550 C300 650, 100 750, 100 850 C100 950, 300 1050, 300 1150 C300 1250, 200 1350, 200 1500"
        class="stroke-white/10 stroke-1 fill-none"
      />
      <path
        id="main-path"
        d="M200 0 C200 100, 100 150, 100 250 C100 350, 300 450, 300 550 C300 650, 100 750, 100 850 C100 950, 300 1050, 300 1150 C300 1250, 200 1350, 200 1500"
        class="stroke-[#72bf78] stroke-3 fill-none transition-all duration-300"
        filter="url(#glow)"
      />
    </svg>

    <div class="relative flex flex-col space-y-32">
      {education.map((item) => (
        <div class={`edu-item flex w-full ${item.side === 'left' ? 'md:justify-start' : 'md:justify-end'} justify-center`}>
          
          <div class={`group relative p-1 rounded-2xl transition-all duration-500 hover:scale-[1.02]`}>
            <div class="absolute inset-0 bg-linear-to-br from-[#72bf78]/20 to-transparent rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"></div>
            
            <div class="relative bg-[#0d0d0d] border border-white/10 p-6 md:p-8 rounded-2xl w-75 md:w-87.5 overflow-hidden">
              <div class="absolute top-0 right-0 w-12 h-12 bg-[#72bf78]/10 rounded-bl-full -mr-6 -mt-6 group-hover:bg-[#72bf78]/20 transition-colors"></div>
              
              <div class="flex items-center gap-3 mb-4">
                <span class="px-3 py-1 bg-[#72bf78]/10 text-[#72bf78] font-mono text-[10px] rounded-full border border-[#72bf78]/20">
                  {item.year}
                </span>
                <div class="h-px flex-1 bg-white/10"></div>
              </div>

              <h3 class="text-white font-black text-xl md:text-2xl uppercase tracking-tighter mb-2 group-hover:text-[#72bf78] transition-colors italic">
                {item.title}
              </h3>
              <p class="text-neutral-400 font-light text-sm md:text-base border-l-2 border-[#72bf78]/30 pl-4">
                {item.course}
              </p>
            </div>

            <div class={`absolute top-1/2 -translate-y-1/2 hidden md:flex items-center
              ${item.side === 'left' ? '-right-4 flex-row' : '-left-4 flex-row-reverse'}`}>
              <div class="w-8 h-0.5 bg-linear-to-r from-[#72bf78] to-transparent"></div>
              <div class="w-3 h-3 rounded-full bg-[#72bf78] shadow-[0_0_10px_#72bf78]"></div>
            </div>
          </div>

        </div>
      ))}
    </div>
  </div>
</section>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  const animateEducation = () => {
    const mainPath = document.querySelector("#main-path") as SVGPathElement;
    if (!mainPath) return;

    const length = mainPath.getTotalLength();
    gsap.set(mainPath, { strokeDasharray: length, strokeDashoffset: length });

    // Animación de la línea
    gsap.to(mainPath, {
      strokeDashoffset: 0,
      ease: "none",
      scrollTrigger: {
        trigger: "#education-section",
        start: "top 25%",
        end: "bottom bottom",
        scrub: 1,
      }
    });

    // Animación de Cards
    const items = document.querySelectorAll(".edu-item");
    items.forEach((item) => {
      gsap.from(item, {
        x: item.classList.contains('md:justify-start') ? -50 : 50,
        opacity: 0,
        filter: "blur(10px)",
        scrollTrigger: {
          trigger: item,
          start: "top 80%",
          end: "top 50%",
          scrub: true,
        }
      });
    });
  };

  animateEducation();
  document.addEventListener("astro:after-swap", animateEducation);
</script>

<style>
  /* Efecto de Scan en el fondo de las cards */
  .group::after {
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(to bottom, transparent, rgba(114, 191, 120, 0.05), transparent);
    transform: translateY(-100%);
    transition: transform 0.6s;
  }
  .group:hover::after {
    transform: translateY(100%);
  }

  /* Responsive para el SVG */
  @media (max-width: 768px) {
    svg {
      width: 200%;
      left: -50%;
      opacity: 0.2;
    }
  }
</style>