<canvas id="cursor-canvas" class="fixed top-0 left-0 pointer-events-none z-99999"></canvas>

<style>
  :global(html), :global(body) {
    /* Mantenemos el cursor normal del sistema como pediste */
    cursor: auto !important;
  }

  #cursor-canvas {
    width: 100vw;
    height: 100vh;
  }
</style>

<script>
  const initCanvasCursor = () => {
    const canvas = document.getElementById('cursor-canvas') as HTMLCanvasElement;
    if (!canvas) return;

    const ctx = canvas.getContext('2d');
    if (!ctx) return;

    let points: {x: number, y: number, age: number}[] = [];
    const maxAge = 20; // Duración de la estela

    const resize = () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    };

    const addPoint = (x: number, y: number) => {
      points.push({ x, y, age: 0 });
    };

    const animate = () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      if (points.length > 1) {
        ctx.beginPath();
        ctx.strokeStyle = '#72bf78'; // Tu color verde
        ctx.lineWidth = 2;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';

        for (let i = 0; i < points.length - 1; i++) {
          const p1 = points[i];
          const p2 = points[i + 1];
          
          // Efecto de desvanecimiento: la línea es más transparente al final
          const opacity = 1 - p1.age / maxAge;
          ctx.strokeStyle = `rgba(114, 191, 120, ${opacity})`;
          
          ctx.beginPath();
          ctx.moveTo(p1.x, p1.y);
          ctx.lineTo(p2.x, p2.y);
          ctx.stroke();
          
          p1.age++;
        }
      }

      // Eliminar puntos viejos
      points = points.filter(p => p.age < maxAge);
      requestAnimationFrame(animate);
    };

    const onMouseMove = (e: MouseEvent) => {
      addPoint(e.clientX, e.clientY);
    };

    window.addEventListener('resize', resize);
    window.addEventListener('mousemove', onMouseMove);
    
    resize();
    animate();

    // Limpieza para Astro View Transitions
    return () => {
      window.removeEventListener('resize', resize);
      window.removeEventListener('mousemove', onMouseMove);
    };
  };

  // Inicializar
  let cleanup = initCanvasCursor();

  document.addEventListener('astro:after-swap', () => {
    if (cleanup) cleanup();
    cleanup = initCanvasCursor();
  });
</script>